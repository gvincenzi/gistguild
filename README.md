# GIST Guild, a Distributed Federated Universe
## Description
GIST Guild is a didactical projectâ€‹realizing a **Telegram BOT Order Management System** based on a data **Distriduted Federated Universe**.
The Universe federates all softwares using a set of *document specializations*, based on a *common document*, stocked in Mongo collections, and exchanged via a [LavinMQ Message Broker](https://lavinmq.com/).
Each software federating the GIST Guild Universe can launch one or more *node* : each node is accessible by credential generated by backend.

***Spring Security*** is the component used to manage security, for API and for GUI access.

## First software federating the GIST Guild
The first two software of this universe will be : 
- **GasSMan**: an italian association that works for an ethical purchasing group
- **InMediArt**: an italian association that works for independent artists production and distribution  

## Used Technologies
- [Apache Maven](https://maven.apache.org/)
- Spring Boot
- Spring Cloud (Netflix Eureka Server, Zuul, Hystrix, Stream Rabbit, Feign Client)
- [Spring Data MongoDB](https://spring.io/projects/spring-data-mongodb)
- [Spring Security](https://spring.io/projects/spring-security)
- [MongoDB](https://www.mongodb.com/) 
- [LavinMQ Message Broker](https://lavinmq.com/)

## Documents 
The document specializations are:
- Participant
- Product
- Order
- RechargeCredit

All document specializations have this common parameters:
- Timestamp (creation)
- LastUpdateTimestamp
- ID (hashcode processed at the creation)
- PreviousID

### Participant
Each Telegram user which interacts with BOT, can sign up a software in the universe: she/he becomes a **participant**.
As a **participant** she/he can *show the catalog, order a product, pay an order*.

The first participant of a software is called ***Genesis Participant***: he becomes automatically a *federate participant*.

### Federate Participant 
A federate participant is a participant which can access a node GUI : via the GUI she/he can *add/modify/remove a product for her/his own catalog, view/modify his orders, view/modify all software participant, recharge participant credits*.

### Product 
A product is a document described by a common set of properties:
- Name
- Description (HTML accepted with image or video link previewed by Telegram features)
- Price

Then you can set other properties if make a sense for your product:
- Available quantity (if there is a physical limitation)
- With Delivery (if you need to send something to a shipping address)
- URL (for digital products)
- Password (if product consuming need to know a password)

### Order
A Participant, via the GIST Guild bot, can consult the product catalog and register an order.
The bot will ask informations to participant related to chooses product characteristics.

An Order has this parameters list:
- Product
- Quantity (if product has got an availability)
- Shipping address (if product is "delivered"
- Amount (automatically processed during registration process)
- Paid (processed on demand, by BOT or Node GUI)

### RechargeCredit
This document will be created for each credit transaction type:
- *FREE* (signing up a participant can receive free credits
- *ADMIN* (federate participants can recharge a participant)
- *INVOICE* (a participant can recharge credit via a payment in Telegram, using a system as Stripe)
- *PAYMENT* (in this case the credit will be reduced by transaction)

This document contains:
- Old Credit (before transaction)
- New Credit (after transaction)
- Type (Free, Invoice, Admin, Payment)

## A universe designed as a Microservices architecture 
The GIST Guild Distributed Federated Universe is designed by **Atomic Architecture** : a microservices event-driven system.

It is composed of 3 *molecules*:
- ***Distribution***
- ***Node***
- ***GUI (Telegram Bot)***

### Distribution
It's a molecule that expose a spike (API REST) to receive document insertion (or update) proposition.
If there is not blocking request to the universe in progress (another insertion or update), this microservice build a RequestMessage, with all document proposition details and an unique Correlation ID, and writes it on LavinMQ "request" channel.

It subscribe (exclusively) the "response" channel to wait all responses to requests sent.

When it receives response for corresponding Correlation ID, it will write a message on "distribution" channel of message broker to distribute the information to all active nodes.

### Node
It's a molecule subscribing the [LavinMQ](https://lavinmq.com/) "request" channel, with a ***common group name*** for all nodes: when it receives a document proposition, it will update its own Mongo instance, and it will send a response (with eventually exceptions) in "response" channel on [LavinMQ](https://lavinmq.com/): only Distribution molecule will subscribe this channel et redistribute to other node the new insertion/update.

A Node has also a atom that expose a Thymeleaf interface, accessible only to federate participants, in which it is possible to:
- Verify the registry integrity (sending a specific request to Distribution Spike and attending all responses (one per document specialization) on response channel
- Create/Modify/Delete a Product
- Modify a participant 
- Recharge participant credits
- View/Modify orders of its own products

### GUI (Telegram bot)
This molecule contains a Telegram BOT: this bot calls the Distribution molecule Spike (API REST) to send their requests, and that subscribes to the 'response' channel of message broker to receives and process responses from nodes.
Via the bot, Telegram users can:
- ***Sign up*** to the univers, becooming a *participant*
- See the ***Catalog*** (all products of all federate participants)
- ***Find a product*** by a word that will be searched in product names and tags
- See the list of ***her/his own orders*** in progress
- See the list of ***purchased product***
- Check ***remaining credit***
- ***Cancellation*** of a participant 

#### Communication, a meta document
In this project the bean **Communication** is used as a Document sent in message broker response channel: in this object the system will find all information to send a notification (via Telegram BOT) to participants.

